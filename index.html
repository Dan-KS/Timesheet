<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Timesheet System</title>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // Your live API URL - connected to Azure SQL Database
        const API_BASE_URL = 'https://timesheet-api-dpcxh5gca6bthgeb.uksouth-01.azurewebsites.net/api';

        // Icon components
        const Plus = () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 5v14m7-7H5" /></svg>;
        const Settings = () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" /><circle cx={12} cy={12} r={3} /></svg>;
        const Download = () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4m7-10l4 4m0 0l4-4m-4 4V3" /></svg>;
        const Save = () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z" /><polyline points="17,21 17,13 7,13 7,21" /><polyline points="7,3 7,8 15,8" /></svg>;
        const RefreshCw = ({ className }) => <svg className={className || "w-4 h-4"} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg>;
        const AlertCircle = () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx={12} cy={12} r={10} /><line x1={12} y1={8} x2={12} y2={12} /><line x1={12} y1={16} x2="12.01" y2={16} /></svg>;
        const ChevronLeft = () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" /></svg>;
        const ChevronRight = () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" /></svg>;
        const Edit = () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>;
        const X = () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" /></svg>;
        const UserPlus = () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z" /></svg>;

        const TimesheetSystem = () => {
            // All state variables in one place
            const [currentWeek, setCurrentWeek] = React.useState(getWeekStart(new Date()));
            const [projects, setProjects] = React.useState([]);
            const [members, setMembers] = React.useState([]);
            const [selectedMember, setSelectedMember] = React.useState(null);
            const [timeEntries, setTimeEntries] = React.useState({});
            const [loading, setLoading] = React.useState(true);
            const [saving, setSaving] = React.useState(false);
            const [hasUnsavedChanges, setHasUnsavedChanges] = React.useState(false);
            const [error, setError] = React.useState(null);
            const [showProjectManager, setShowProjectManager] = React.useState(false);
            const [showTeamManager, setShowTeamManager] = React.useState(false);
            const [editingProject, setEditingProject] = React.useState(null);
            const [editingMember, setEditingMember] = React.useState(null);

            const weekDays = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];

            function getWeekStart(date) {
                const d = new Date(date);
                const day = d.getDay();
                const diff = d.getDate() - day + (day === 0 ? -6 : 1);
                const weekStart = new Date(d.setDate(diff));
                weekStart.setHours(0, 0, 0, 0);
                return weekStart;
            }

            function formatDate(date) {
                return date.toISOString().split('T')[0];
            }

            function getWeekDates() {
                return weekDays.map((_, index) => {
                    const date = new Date(currentWeek);
                    date.setDate(currentWeek.getDate() + index);
                    return date;
                });
            }

            const getNextWeek = () => {
                const nextWeek = new Date(currentWeek);
                nextWeek.setDate(currentWeek.getDate() + 7);
                return getWeekStart(nextWeek);
            };

            const getPreviousWeek = () => {
                const prevWeek = new Date(currentWeek);
                prevWeek.setDate(currentWeek.getDate() - 7);
                return getWeekStart(prevWeek);
            };

            // API calls
            const apiCall = async (endpoint, options = {}) => {
                try {
                    setError(null);
                    const response = await fetch(`${API_BASE_URL}${endpoint}`, {
                        headers: {
                            'Content-Type': 'application/json',
                            ...options.headers,
                        },
                        ...options,
                    });
                    
                    if (!response.ok) {
                        throw new Error(`API Error: ${response.status}`);
                    }
                    
                    return await response.json();
                } catch (error) {
                    console.error(`API call failed: ${endpoint}`, error);
                    setError(`Connection failed: ${error.message}`);
                    throw error;
                }
            };

            const loadMembers = async () => {
                try {
                    const data = await apiCall('/members');
                    setMembers(data);
                    if (data.length > 0 && !selectedMember) {
                        setSelectedMember(data[0]);
                    }
                } catch (error) {
                    console.error('Failed to load members:', error);
                }
            };

            const loadProjects = async () => {
                try {
                    const data = await apiCall('/projects');
                    setProjects(data.map(p => ({
                        id: p.ProjectID,
                        name: p.ProjectName,
                        code: p.ProjectCode,
                        billable: p.Billable
                    })));
                } catch (error) {
                    console.error('Failed to load projects:', error);
                }
            };

            const loadTimesheetData = async () => {
                if (!selectedMember) return;

                try {
                    const weekStart = formatDate(currentWeek);
                    const data = await apiCall(`/timesheet/${selectedMember.MemberID}/${weekStart}`);
                    
                    const entries = {};
                    data.forEach(entry => {
                        const date = new Date(entry.EntryDate);
                        const dayIndex = (date.getDay() + 6) % 7;
                        const key = `${entry.ProjectID}-${dayIndex}`;
                        entries[key] = {
                            hours: entry.Hours || '',
                            task: entry.TaskDescription || ''
                        };
                    });
                    
                    setTimeEntries(entries);
                    setHasUnsavedChanges(false);
                } catch (error) {
                    console.error('Failed to load timesheet data:', error);
                    setTimeEntries({});
                    setHasUnsavedChanges(false);
                }
            };

            const saveAllChanges = async () => {
                if (!selectedMember || !hasUnsavedChanges) return;

                setSaving(true);
                let successCount = 0;
                let errorCount = 0;

                try {
                    for (const [key, entry] of Object.entries(timeEntries)) {
                        if (entry.hours || entry.task) {
                            const [projectId, dayIndex] = key.split('-').map(Number);
                            
                            const entryDate = new Date(currentWeek);
                            entryDate.setDate(currentWeek.getDate() + dayIndex);

                            try {
                                await apiCall('/timesheet', {
                                    method: 'POST',
                                    body: JSON.stringify({
                                        memberId: selectedMember.MemberID,
                                        projectId: projectId,
                                        entryDate: formatDate(entryDate),
                                        weekStarting: formatDate(currentWeek),
                                        hours: entry.hours || null,
                                        taskDescription: entry.task || null
                                    })
                                });
                                successCount++;
                            } catch (error) {
                                console.error('Failed to save entry:', error);
                                errorCount++;
                            }
                        }
                    }

                    if (errorCount === 0) {
                        setHasUnsavedChanges(false);
                        setError(null);
                        alert(`Successfully saved ${successCount} entries!`);
                    } else {
                        setError(`Saved ${successCount} entries, but ${errorCount} failed. Please try again.`);
                    }
                } catch (error) {
                    setError('Failed to save timesheet. Please try again.');
                } finally {
                    setSaving(false);
                }
            };

            const updateTimeEntry = (projectId, dayIndex, field, value) => {
                const key = `${projectId}-${dayIndex}`;
                setTimeEntries(prev => ({
                    ...prev,
                    [key]: {
                        ...prev[key],
                        [field]: value
                    }
                }));
                
                setHasUnsavedChanges(true);
            };

            const getTimeEntry = (projectId, dayIndex, field = 'hours') => {
                const key = `${projectId}-${dayIndex}`;
                return timeEntries[key]?.[field] || '';
            };

            const getDayTotal = (dayIndex) => {
                return projects.reduce((total, project) => {
                    const hours = parseFloat(getTimeEntry(project.id, dayIndex, 'hours')) || 0;
                    return total + hours;
                }, 0);
            };

            const getProjectTotal = (projectId) => {
                return weekDays.reduce((total, _, dayIndex) => {
                    const hours = parseFloat(getTimeEntry(projectId, dayIndex, 'hours')) || 0;
                    return total + hours;
                }, 0);
            };

            const getWeekTotal = () => {
                return projects.reduce((total, project) => total + getProjectTotal(project.id), 0);
            };

            const copyFromLastWeek = async () => {
                if (!selectedMember) return;

                const lastWeek = new Date(currentWeek);
                lastWeek.setDate(currentWeek.getDate() - 7);

                try {
                    const weekStart = formatDate(lastWeek);
                    const data = await apiCall(`/timesheet/${selectedMember.MemberID}/${weekStart}`);
                    
                    let copiedEntries = 0;
                    const newEntries = { ...timeEntries };
                    
                    for (const entry of data) {
                        if (entry.Hours || entry.TaskDescription) {
                            const date = new Date(entry.EntryDate);
                            const dayIndex = (date.getDay() + 6) % 7;
                            const key = `${entry.ProjectID}-${dayIndex}`;
                            
                            if (!newEntries[key] || (!newEntries[key].hours && !newEntries[key].task)) {
                                newEntries[key] = {
                                    ...newEntries[key],
                                    hours: entry.Hours || '',
                                    task: entry.TaskDescription || ''
                                };
                                copiedEntries++;
                            }
                        }
                    }
                    
                    if (copiedEntries > 0) {
                        setTimeEntries(newEntries);
                        setHasUnsavedChanges(true);
                        alert(`Copied ${copiedEntries} entries from last week! Remember to click Save to store the data.`);
                    } else {
                        alert('No data found from last week, or current week already has data.');
                    }
                } catch (error) {
                    alert('Failed to copy from last week. Please try again.');
                }
            };

            const exportData = async () => {
                if (!selectedMember) return;

                try {
                    const weekStart = formatDate(currentWeek);
                    const weekEnd = formatDate(new Date(currentWeek.getTime() + 6 * 24 * 60 * 60 * 1000));
                    
                    const exportData = {
                        week: `${weekStart} to ${weekEnd}`,
                        member: selectedMember.Name,
                        entries: projects.map(project => ({
                            project: project.name,
                            code: project.code,
                            billable: project.billable,
                            days: weekDays.map((day, index) => ({
                                day,
                                date: formatDate(getWeekDates()[index]),
                                hours: parseFloat(getTimeEntry(project.id, index, 'hours')) || 0,
                                task: getTimeEntry(project.id, index, 'task') || ''
                            })),
                            total: getProjectTotal(project.id)
                        })),
                        weekTotal: getWeekTotal()
                    };

                    const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `timesheet_${selectedMember.Name.replace(' ', '_')}_${weekStart}.json`;
                    a.click();
                    URL.revokeObjectURL(url);
                } catch (error) {
                    alert('Failed to export data. Please try again.');
                }
            };

            // Team and project management functions
            const addMember = async () => {
                const name = prompt('Enter team member name:');
                const email = prompt('Enter email address:');
                
                if (!name || !email) return;

                try {
                    await apiCall('/members', {
                        method: 'POST',
                        body: JSON.stringify({ name, email })
                    });
                    await loadMembers();
                    alert('Team member added successfully!');
                } catch (error) {
                    alert('Failed to add team member. Please try again.');
                }
            };

            const updateMember = async (id, field, value) => {
                try {
                    await apiCall(`/members/${id}`, {
                        method: 'PUT',
                        body: JSON.stringify({ [field]: value })
                    });
                    await loadMembers();
                    setEditingMember(null);
                } catch (error) {
                    alert('Failed to update team member. Please try again.');
                }
            };

            const addProject = async () => {
                const newProject = {
                    projectCode: `PRJ${String(Math.max(...projects.map(p => p.id), 0) + 1).padStart(3, '0')}`,
                    projectName: 'New Project',
                    billable: true
                };

                try {
                    await apiCall('/projects', {
                        method: 'POST',
                        body: JSON.stringify(newProject)
                    });
                    await loadProjects();
                    alert('Project added successfully!');
                } catch (error) {
                    alert('Failed to add project. Please try again.');
                }
            };

            const updateProject = async (id, field, value) => {
                const project = projects.find(p => p.id === id);
                if (!project) return;

                const updatedProject = {
                    projectCode: field === 'code' ? value : project.code,
                    projectName: field === 'name' ? value : project.name,
                    billable: field === 'billable' ? value : project.billable
                };

                try {
                    await apiCall(`/projects/${id}`, {
                        method: 'PUT',
                        body: JSON.stringify(updatedProject)
                    });
                    await loadProjects();
                    setEditingProject(null);
                } catch (error) {
                    alert('Failed to update project. Please try again.');
                }
            };

            // Navigation handlers
            const handleMemberChange = (newMemberId) => {
                if (hasUnsavedChanges) {
                    const confirmSwitch = window.confirm(
                        'You have unsaved changes. Do you want to continue without saving?'
                    );
                    if (!confirmSwitch) return;
                }
                const member = members.find(m => m.MemberID === parseInt(newMemberId));
                setSelectedMember(member);
                setHasUnsavedChanges(false);
            };

            const handleWeekChange = (newDate) => {
                if (hasUnsavedChanges) {
                    const confirmSwitch = window.confirm(
                        'You have unsaved changes. Do you want to continue without saving?'
                    );
                    if (!confirmSwitch) return;
                }
                setCurrentWeek(getWeekStart(new Date(newDate)));
                setHasUnsavedChanges(false);
            };

            const handleNextWeek = () => {
                if (hasUnsavedChanges) {
                    const confirmSwitch = window.confirm(
                        'You have unsaved changes. Do you want to continue without saving?'
                    );
                    if (!confirmSwitch) return;
                }
                setCurrentWeek(getNextWeek());
                setHasUnsavedChanges(false);
            };

            const handlePreviousWeek = () => {
                if (hasUnsavedChanges) {
                    const confirmSwitch = window.confirm(
                        'You have unsaved changes. Do you want to continue without saving?'
                    );
                    if (!confirmSwitch) return;
                }
                setCurrentWeek(getPreviousWeek());
                setHasUnsavedChanges(false);
            };

            // Load initial data
            React.useEffect(() => {
                const initializeData = async () => {
                    setLoading(true);
                    try {
                        await Promise.all([loadMembers(), loadProjects()]);
                    } finally {
                        setLoading(false);
                    }
                };

                initializeData();
            }, []);

            // Load timesheet data when member or week changes
            React.useEffect(() => {
                if (selectedMember && !loading) {
                    loadTimesheetData();
                }
            }, [selectedMember, currentWeek, loading]);

            // Warning when leaving page with unsaved changes
            React.useEffect(() => {
                const handleBeforeUnload = (e) => {
                    if (hasUnsavedChanges) {
                        e.preventDefault();
                        e.returnValue = 'You have unsaved changes. Are you sure you want to leave?';
                        return e.returnValue;
                    }
                };

                window.addEventListener('beforeunload', handleBeforeUnload);
                return () => window.removeEventListener('beforeunload', handleBeforeUnload);
            }, [hasUnsavedChanges]);

            const weekDates = getWeekDates();

            if (loading) {
                return (
                    <div className="max-w-7xl mx-auto p-6 bg-white">
                        <div className="flex items-center justify-center py-12">
                            <RefreshCw className="animate-spin mr-2 w-6 h-6" />
                            <span>Loading timesheet data...</span>
                        </div>
                    </div>
                );
            }

            return (
                <div className="max-w-7xl mx-auto p-6 bg-white">
                    {error && (
                        <div className="mb-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded flex items-center">
                            <AlertCircle />
                            <span className="ml-2">{error}</span>
                            <button 
                                onClick={() => setError(null)}
                                className="ml-auto text-red-500 hover:text-red-700"
                            >
                                ×
                            </button>
                        </div>
                    )}

                    <div className="mb-6">
                        <div className="flex items-center justify-between mb-4">
                            <h1 className="text-3xl font-bold text-gray-800">Team Timesheet</h1>
                            <div className="flex gap-2">
                                <button
                                    onClick={saveAllChanges}
                                    disabled={!hasUnsavedChanges || saving}
                                    className={`flex items-center gap-2 px-4 py-2 text-white rounded ${
                                        hasUnsavedChanges && !saving 
                                            ? 'bg-green-600 hover:bg-green-700' 
                                            : 'bg-gray-400 cursor-not-allowed'
                                    }`}
                                >
                                    <Save />
                                    {saving ? 'Saving...' : 'Save Timesheet'}
                                </button>
                                <button
                                    onClick={() => setShowTeamManager(!showTeamManager)}
                                    className="flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700"
                                >
                                    <UserPlus />
                                    Team
                                </button>
                                <button
                                    onClick={() => setShowProjectManager(!showProjectManager)}
                                    className="flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"
                                >
                                    <Settings />
                                    Projects
                                </button>
                                <button
                                    onClick={exportData}
                                    className="flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700"
                                >
                                    <Download />
                                    Export
                                </button>
                            </div>
                        </div>

                        <div className="flex items-center gap-4 mb-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">Team Member</label>
                                <select
                                    value={selectedMember?.MemberID || ''}
                                    onChange={(e) => handleMemberChange(e.target.value)}
                                    className="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                >
                                    {members.map(member => (
                                        <option key={member.MemberID} value={member.MemberID}>{member.Name}</option>
                                    ))}
                                </select>
                            </div>
                            
                            <div className="flex items-center gap-1">
                                <label className="block text-sm font-medium text-gray-700 mb-1">Week Starting</label>
                                <div className="flex items-center gap-1">
                                    <button
                                        onClick={handlePreviousWeek}
                                        className="p-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded"
                                        title="Previous week"
                                    >
                                        <ChevronLeft />
                                    </button>
                                    <input
                                        type="date"
                                        value={formatDate(currentWeek)}
                                        onChange={(e) => handleWeekChange(e.target.value)}
                                        className="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    />
                                    <button
                                        onClick={handleNextWeek}
                                        className="p-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded"
                                        title="Next week"
                                    >
                                        <ChevronRight />
                                    </button>
                                </div>
                            </div>

                            {hasUnsavedChanges && (
                                <div className="flex items-center text-orange-600 bg-orange-50 px-3 py-2 rounded border border-orange-200">
                                    <AlertCircle />
                                    <span className="ml-2 font-medium">You have unsaved changes</span>
                                </div>
                            )}

                            {saving && (
                                <div className="flex items-center text-sm text-gray-600">
                                    <RefreshCw className="animate-spin mr-1 w-4 h-4" />
                                    Saving to database...
                                </div>
                            )}
                        </div>
                    </div>

                    {showTeamManager && (
                        <div className="mb-6 p-4 bg-indigo-50 rounded-lg border">
                            <div className="flex items-center justify-between mb-4">
                                <h2 className="text-xl font-semibold">Team Management</h2>
                                <button
                                    onClick={addMember}
                                    className="flex items-center gap-2 px-3 py-1 bg-indigo-600 text-white rounded hover:bg-indigo-700"
                                >
                                    <Plus />
                                    Add Team Member
                                </button>
                            </div>
                            
                            <div className="space-y-2">
                                {members.map(member => (
                                    <div key={member.MemberID} className="flex items-center gap-3 p-3 bg-white rounded border">
                                        {editingMember === member.MemberID ? (
                                            <>
                                                <input
                                                    type="text"
                                                    defaultValue={member.Name}
                                                    className="flex-1 px-2 py-1 border border-gray-300 rounded"
                                                    placeholder="Name"
                                                    onBlur={(e) => {
                                                        if (e.target.value !== member.Name) {
                                                            updateMember(member.MemberID, 'name', e.target.value);
                                                        } else {
                                                            setEditingMember(null);
                                                        }
                                                    }}
                                                    onKeyPress={(e) => {
                                                        if (e.key === 'Enter') {
                                                            updateMember(member.MemberID, 'name', e.target.value);
                                                        }
                                                    }}
                                                    autoFocus
                                                />
                                                <button
                                                    onClick={() => setEditingMember(null)}
                                                    className="p-1 text-gray-600 hover:bg-gray-100 rounded"
                                                >
                                                    <X />
                                                </button>
                                            </>
                                        ) : (
                                            <>
                                                <span className="flex-1 font-medium">{member.Name}</span>
                                                <button
                                                    onClick={() => setEditingMember(member.MemberID)}
                                                    className="p-1 text-blue-600 hover:bg-blue-100 rounded"
                                                >
                                                    <Edit />
                                                </button>
                                            </>
                                        )}
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}

                    {showProjectManager && (
                        <div className="mb-6 p-4 bg-gray-50 rounded-lg border">
                            <div className="flex items-center justify-between mb-4">
                                <h2 className="text-xl font-semibold">Project Management</h2>
                                <button
                                    onClick={addProject}
                                    className="flex items-center gap-2 px-3 py-1 bg-green-600 text-white rounded hover:bg-green-700"
                                >
                                    <Plus />
                                    Add Project
                                </button>
                            </div>
                            
                            <div className="space-y-2">
                                {projects.map(project => (
                                    <div key={project.id} className="flex items-center gap-3 p-3 bg-white rounded border">
                                        {editingProject === project.id ? (
                                            <>
                                                <input
                                                    type="text"
                                                    defaultValue={project.name}
                                                    className="flex-1 px-2 py-1 border border-gray-300 rounded"
                                                    placeholder="Project Name"
                                                    onBlur={(e) => {
                                                        if (e.target.value !== project.name) {
                                                            updateProject(project.id, 'name', e.target.value);
                                                        } else {
                                                            setEditingProject(null);
                                                        }
                                                    }}
                                                    onKeyPress={(e) => {
                                                        if (e.key === 'Enter') {
                                                            updateProject(project.id, 'name', e.target.value);
                                                        }
                                                    }}
                                                    autoFocus
                                                />
                                                <input
                                                    type="text"
                                                    defaultValue={project.code}
                                                    className="w-24 px-2 py-1 border border-gray-300 rounded"
                                                    placeholder="Code"
                                                    onBlur={(e) => {
                                                        if (e.target.value !== project.code) {
                                                            updateProject(project.id, 'code', e.target.value);
                                                        }
                                                    }}
                                                    onKeyPress={(e) => {
                                                        if (e.key === 'Enter') {
                                                            updateProject(project.id, 'code', e.target.value);
                                                        }
                                                    }}
                                                />
                                                <label className="flex items-center gap-1">
                                                    <input
                                                        type="checkbox"
                                                        defaultChecked={project.billable}
                                                        onChange={(e) => updateProject(project.id, 'billable', e.target.checked)}
                                                    />
                                                    Billable
                                                </label>
                                                <button
                                                    onClick={() => setEditingProject(null)}
                                                    className="p-1 text-gray-600 hover:bg-gray-100 rounded"
                                                >
                                                    <X />
                                                </button>
                                            </>
                                        ) : (
                                            <>
                                                <span className="flex-1 font-medium">{project.name}</span>
                                                <span className="w-20 text-sm text-gray-600">{project.code}</span>
                                                <span className={`inline-block w-3 h-3 rounded-full ${project.billable ? 'bg-green-500' : 'bg-gray-400'}`}></span>
                                                <span className="text-sm">{project.billable ? 'Billable' : 'Non-billable'}</span>
                                                <button
                                                    onClick={() => setEditingProject(project.id)}
                                                    className="p-1 text-blue-600 hover:bg-blue-100 rounded"
                                                >
                                                    <Edit />
                                                </button>
                                            </>
                                        )}
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}

                    <div className="overflow-x-auto">
                        <table className="w-full border-collapse bg-white shadow-sm">
                            <thead>
                                <tr className="bg-gray-50">
                                    <th className="border border-gray-200 p-3 text-left font-semibold">Project</th>
                                    <th className="border border-gray-200 p-3 text-left font-semibold">Code</th>
                                    <th className="border border-gray-200 p-1 text-center font-semibold">Bill</th>
                                    {weekDates.map((date, index) => (
                                        <th key={index} className="border border-gray-200 p-3 text-center font-semibold min-w-32">
                                            <div>{weekDays[index]}</div>
                                            <div className="text-sm font-normal text-gray-600">
                                                {date.toLocaleDateString('en-GB', { day: '2-digit', month: '2-digit' })}
                                            </div>
                                        </th>
                                    ))}
                                    <th className="border border-gray-200 p-3 text-center font-semibold">Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                {projects.map(project => (
                                    <React.Fragment key={project.id}>
                                        <tr>
                                            <td className="border border-gray-200 p-3 font-medium">{project.name}</td>
                                            <td className="border border-gray-200 p-3 text-sm text-gray-600">{project.code}</td>
                                            <td className="border border-gray-200 p-1 text-center">
                                                <span className={`inline-block w-3 h-3 rounded-full ${project.billable ? 'bg-green-500' : 'bg-gray-400'}`}></span>
                                            </td>
                                            {weekDays.map((_, dayIndex) => (
                                                <td key={dayIndex} className="border border-gray-200 p-1">
                                                    <input
                                                        type="number"
                                                        step="0.5"
                                                        min="0"
                                                        max="24"
                                                        value={getTimeEntry(project.id, dayIndex, 'hours')}
                                                        onChange={(e) => updateTimeEntry(project.id, dayIndex, 'hours', e.target.value)}
                                                        className="w-full p-2 text-center border-0 focus:bg-blue-50 focus:outline-none"
                                                        placeholder="0"
                                                    />
                                                </td>
                                            ))}
                                            <td className="border border-gray-200 p-3 text-center font-semibold">
                                                {getProjectTotal(project.id).toFixed(1)}h
                                            </td>
                                        </tr>
                                        <tr>
                                            <td className="border border-gray-200 p-1 text-sm text-gray-600">Tasks</td>
                                            <td className="border border-gray-200"></td>
                                            <td className="border border-gray-200"></td>
                                            {weekDays.map((_, dayIndex) => (
                                                <td key={dayIndex} className="border border-gray-200 p-1">
                                                    <input
                                                        type="text"
                                                        value={getTimeEntry(project.id, dayIndex, 'task')}
                                                        onChange={(e) => updateTimeEntry(project.id, dayIndex, 'task', e.target.value)}
                                                        className="w-full p-1 text-xs border-0 focus:bg-yellow-50 focus:outline-none"
                                                        placeholder="Task description..."
                                                    />
                                                </td>
                                            ))}
                                            <td className="border border-gray-200"></td>
                                        </tr>
                                    </React.Fragment>
                                ))}
                            </tbody>
                            <tfoot>
                                <tr className="bg-gray-50 font-semibold">
                                    <td className="border border-gray-200 p-3">Daily Totals</td>
                                    <td className="border border-gray-200"></td>
                                    <td className="border border-gray-200"></td>
                                    {weekDays.map((_, dayIndex) => (
                                        <td key={dayIndex} className="border border-gray-200 p-3 text-center">
                                            {getDayTotal(dayIndex).toFixed(1)}h
                                        </td>
                                    ))}
                                    <td className="border border-gray-200 p-3 text-center bg-blue-50">
                                        {getWeekTotal().toFixed(1)}h
                                    </td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                    
                    <div className="mt-4 text-sm text-gray-600 flex items-center justify-between">
                        <div>
                            <p>• Enter hours in 0.5 increments • Green dots indicate billable projects • <strong>Click Save to store data to database</strong></p>
                            <p className="text-xs text-green-600 mt-1">✅ Connected to live database</p>
                        </div>
                        <button
                            onClick={copyFromLastWeek}
                            className="text-blue-600 hover:text-blue-800 hover:underline cursor-pointer"
                        >
                            Copy from last week
                        </button>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<TimesheetSystem />, document.getElementById('root'));
    </script>
</body>
</html>
